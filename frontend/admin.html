<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Bureau | The NSS Chronicle</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∞</text></svg>">

    <style>
        /* Admin Specific Styles matching the Theme */
        .admin-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .admin-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: var(--paper);
            border: 2px solid var(--ink);
            padding: 10px 20px;
            font-family: var(--font-accent);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active, .tab-btn:hover {
            background: var(--mustard);
            color: var(--ink);
            transform: translateY(-2px);
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-panel {
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            font-family: var(--font-accent);
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--ink);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--ink);
            background: rgba(255, 255, 255, 0.8);
            font-family: var(--font-body);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--mustard);
            background: #fff;
            box-shadow: 4px 4px 0 rgba(225, 173, 1, 0.2);
        }

        .btn-admin {
            background: var(--ink);
            color: #fff;
            border: none;
            padding: 12px 30px;
            font-family: var(--font-accent);
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .btn-admin:hover {
            background: var(--mustard);
            color: var(--ink);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background: #8b0000;
            color: #fff;
            border: none;
            padding: 5px 10px;
            font-family: var(--font-accent);
            font-size: 0.8rem;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .btn-danger:hover {
            background: red;
        }

        .gallery-grid-admin {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .admin-photo-card {
            position: relative;
            background: #fff;
            border: 1px solid var(--ink);
            padding: 10px;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        }

        .admin-photo-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            filter: grayscale(20%);
        }

        .admin-photo-info {
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .admin-photo-title {
            font-weight: bold;
            font-family: var(--font-accent);
            margin-bottom: 4px;
        }

        .badge-category {
            display: inline-block;
            background: var(--mustard);
            color: var(--ink);
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* List Styles for Text Content */
        .content-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }

        .content-item {
            background: #fff;
            border: 1px solid var(--ink);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.05);
        }

        .content-item h4 {
            margin: 0 0 5px 0;
            font-family: var(--font-accent);
        }

        .content-item p {
            margin: 0;
            font-size: 0.9rem;
            color: #555;
        }

        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(244, 241, 234, 0.95);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .login-box {
            width: 100%;
            max-width: 400px;
            padding: 40px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="paper-texture"></div>

    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="glass-panel login-box">
            <h2 class="headline-medium" style="margin-bottom: 20px;">NSS Admin Portal</h2>
            <p style="margin-bottom: 20px; font-style: italic;">Student Coordinators & Faculty Login</p>
            <div class="form-group">
                <input type="password" id="adminPassword" class="form-input" placeholder="Enter Password">
            </div>
            <button onclick="checkLogin()" class="btn-admin">Login</button>
        </div>
    </div>

    <header class="masthead">
        <div class="masthead-top">
            <div class="weather-widget">
                <span>Administrative Console</span>
            </div>
            <div class="date-display" id="currentDate">Loading Date...</div>
            <div class="edition-info">Internal Use Only</div>
        </div>
        
        <div class="brand-container">
            <h1 class="newspaper-name" style="font-size: 3rem;">The NSS Chronicle</h1>
            <h3 style="font-family: var(--font-accent); letter-spacing: 4px; margin-top: 10px; text-transform: uppercase;">Editorial Bureau</h3>
        </div>

        <div class="masthead-bottom">
            <nav class="main-nav">
                <a href="index.html" class="nav-link">‚Üê Back to Front Page</a>
                <span class="nav-link active">Content Management</span>
            </nav>
        </div>
    </header>

    <main class="editorial-content" id="adminContent" style="display: none;">
        
        <section class="admin-container">
            <!-- Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="openTab(event, 'media')">Media & Initiatives</button>
                <button class="tab-btn" onclick="openTab(event, 'halloffame')">Hall of Fame</button>
                <button class="tab-btn" onclick="openTab(event, 'ticker')">Breaking News</button>
                <button class="tab-btn" onclick="openTab(event, 'events')">Upcoming Events</button>
            </div>

            <!-- Tab 1: Media & Initiatives -->
            <div id="media" class="tab-content active">
                <div class="glass-panel admin-panel">
                    <h2 class="headline-medium">Submit New Material</h2>
                    <p style="margin-bottom: 30px; font-style: italic;">Upload photographs for the gallery, slideshow, or header.</p>
                    
                    <form id="galleryUploadForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label class="form-label">Title / Headline</label>
                            <input class="form-input" type="text" name="title" placeholder="Enter a descriptive title" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Section / Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select Placement...</option>
                                <option value="gallery">Photo Gallery (Main Grid)</option>
                                <option value="slideshow">Slideshow (Hero Section)</option>
                                <option value="logo">NSS Seal (Logo)</option>
                                <option value="education">Education Initiative</option>
                                <option value="health">Health Campaign</option>
                                <option value="environment">Environment Drive</option>
                                <option value="community">Community Service</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Caption / Description</label>
                            <textarea class="form-textarea" name="description" rows="3" placeholder="Provide context for the image..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Photograph</label>
                            <input class="form-input" type="file" name="photo" accept="image/jpeg,image/png,image/gif" required>
                        </div>

                        <button type="submit" class="btn-admin">Publish to Archive</button>
                    </form>
                </div>

                <hr class="section-divider">

                <div class="section-header-news">
                    <span class="section-tag">Archives</span>
                    <h2 class="section-headline">Manage Records</h2>
                </div>

                <div class="glass-panel" style="padding: 20px; margin-bottom: 20px; text-align: center;">
                    <span id="photo-count" style="font-family: var(--font-accent); font-weight: bold;">Total Records: 0</span>
                </div>
                
                <div class="gallery-grid-admin" id="gallery-grid">
                    <!-- Items loaded via JS -->
                </div>
            </div>

            <!-- Tab 2: Hall of Fame -->
            <div id="halloffame" class="tab-content">
                <div class="glass-panel admin-panel">
                    <h2 class="headline-medium">Add Award / Recognition</h2>
                    <form id="awardForm">
                        <div class="form-group">
                            <label class="form-label">Year</label>
                            <input class="form-input" type="text" name="year" placeholder="e.g. 2024" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Award Title</label>
                            <input class="form-input" type="text" name="title" placeholder="e.g. Best Unit Award" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" name="description" rows="2" placeholder="Brief details..." required></textarea>
                        </div>
                        <button type="submit" class="btn-admin">Add to Hall of Fame</button>
                    </form>
                </div>
                <div class="content-list" id="award-list">
                    <!-- Awards loaded here -->
                </div>
            </div>

            <!-- Tab 3: Ticker -->
            <div id="ticker" class="tab-content">
                <div class="glass-panel admin-panel">
                    <h2 class="headline-medium">Update Breaking News</h2>
                    <form id="tickerForm">
                        <div class="form-group">
                            <label class="form-label">News Text</label>
                            <input class="form-input" type="text" name="text" placeholder="e.g. Blood Donation Camp tomorrow..." required>
                        </div>
                        <button type="submit" class="btn-admin">Add to Ticker</button>
                    </form>
                </div>
                <div class="content-list" id="ticker-list">
                    <!-- Ticker items loaded here -->
                </div>
            </div>

            <!-- Tab 4: Events -->
            <div id="events" class="tab-content">
                <div class="glass-panel admin-panel">
                    <h2 class="headline-medium">Schedule Upcoming Event</h2>
                    <form id="eventForm">
                        <div class="form-group">
                            <label class="form-label">Event Title</label>
                            <input class="form-input" type="text" name="title" placeholder="e.g. Tree Plantation Drive" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date & Time</label>
                            <input class="form-input" type="text" name="date" placeholder="e.g. Oct 28, 10:00 AM" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input class="form-input" type="text" name="location" placeholder="e.g. Main Ground" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" name="description" rows="2" placeholder="Event details..."></textarea>
                        </div>
                        <button type="submit" class="btn-admin">Add Event</button>
                    </form>
                </div>
                <div class="content-list" id="event-list">
                    <!-- Events loaded here -->
                </div>
            </div>

        </section>

    </main>

    <footer class="newspaper-footer">
        <div class="footer-content">
            <p>&copy; 2025 NSS IIIT-Naya Raipur. Administrative Access.</p>
        </div>
    </footer>

    <script src="scripts/config.js"></script>
    <script>
        // Date Display
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);

        const ADMIN_PASSWORD = 'nssadmin123';
        
        // Login Logic
        function checkLogin() {
            const entered = document.getElementById('adminPassword').value;
            if (entered === ADMIN_PASSWORD) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadGallery();
            } else {
                alert('‚õî Access Denied: Incorrect Credentials');
            }
        }

        // Allow Enter key for login
        document.getElementById('adminPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkLogin();
            }
        });

        // Tab Logic
        function openTab(evt, tabName) {
            const tabs = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            const btns = document.getElementsByClassName('tab-btn');
            for (let i = 0; i < btns.length; i++) {
                btns[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            if (evt) {
                evt.currentTarget.classList.add('active');
            }
            
            // Load content for the tab
            if(tabName === 'media') loadGallery();
            if(tabName === 'halloffame') loadAwards();
            if(tabName === 'ticker') loadTicker();
            if(tabName === 'events') loadEvents();
        }

        // Load Gallery
        async function loadGallery() {
            try {
                const res = await fetch(`${CONFIG.API_BASE_URL}/api/photos`);
                const photos = await res.json();
                
                // Update Logo if exists
                const logoPhoto = photos.find(p => p.category === 'logo');
                if (logoPhoto) {
                    const logoImg = document.querySelector('.logo-stamp img');
                    if (logoImg) logoImg.src = `${CONFIG.API_BASE_URL}${logoPhoto.imageUrl}`;
                }

                const grid = document.getElementById('gallery-grid');
                
                grid.innerHTML = photos.map(p => `
                    <div class="admin-photo-card">
                        <button class="btn-danger" onclick="deletePhoto('${p._id}')">DELETE</button>
                        <img src="${CONFIG.API_BASE_URL}${p.imageUrl}" alt="${p.title}">
                        <div class="admin-photo-info">
                            <div class="admin-photo-title">${p.title}</div>
                            <span class="badge-category">${(p.category || 'General').toUpperCase()}</span>
                            <p style="margin-top: 5px; color: #666;">${p.description || ''}</p>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('photo-count').textContent = `Total Records: ${photos.length}`;
            } catch (err) {
                console.error('Error loading gallery:', err);
            }
        }

        // --- New Load Functions ---

        async function loadAwards() {
            const res = await fetch(`${CONFIG.API_BASE_URL}/api/awards`);
            const items = await res.json();
            document.getElementById('award-list').innerHTML = items.map(i => `
                <div class="content-item">
                    <div>
                        <h4>${i.year}: ${i.title}</h4>
                        <p>${i.description}</p>
                    </div>
                    <button class="btn-danger" style="position:static;" onclick="deleteItem('awards', '${i._id}')">Delete</button>
                </div>
            `).join('');
        }

        async function loadTicker() {
            const res = await fetch(`${CONFIG.API_BASE_URL}/api/ticker`);
            const items = await res.json();
            document.getElementById('ticker-list').innerHTML = items.map(i => `
                <div class="content-item">
                    <p>${i.text}</p>
                    <button class="btn-danger" style="position:static;" onclick="deleteItem('ticker', '${i._id}')">Delete</button>
                </div>
            `).join('');
        }

        async function loadEvents() {
            const res = await fetch(`${CONFIG.API_BASE_URL}/api/events`);
            const items = await res.json();
            document.getElementById('event-list').innerHTML = items.map(i => `
                <div class="content-item">
                    <div>
                        <h4>${i.title} (${i.date})</h4>
                        <p><strong>Location:</strong> ${i.location}</p>
                        <p>${i.description || ''}</p>
                    </div>
                    <button class="btn-danger" style="position:static;" onclick="deleteItem('events', '${i._id}')">Delete</button>
                </div>
            `).join('');
        }

        // --- Generic Delete ---
        async function deleteItem(type, id) {
            if(!confirm('Delete this item?')) return;
            await fetch(`${CONFIG.API_BASE_URL}/api/${type}/${id}`, { method: 'DELETE' });
            if(type === 'awards') loadAwards();
            if(type === 'ticker') loadTicker();
            if(type === 'events') loadEvents();
        }

        // --- Form Handlers ---

        document.getElementById('awardForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            await fetch(`${CONFIG.API_BASE_URL}/api/awards`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(Object.fromEntries(formData))
            });
            e.target.reset();
            loadAwards();
        });

        document.getElementById('tickerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            await fetch(`${CONFIG.API_BASE_URL}/api/ticker`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(Object.fromEntries(formData))
            });
            e.target.reset();
            loadTicker();
        });

        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            await fetch(`${CONFIG.API_BASE_URL}/api/events`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(Object.fromEntries(formData))
            });
            e.target.reset();
            loadEvents();
        });

        // Upload Logic
        document.getElementById('galleryUploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            try {
                const formData = new FormData(e.target);
                const uploadRes = await fetch(`${CONFIG.API_BASE_URL}/api/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await uploadRes.json();
                if (data.success) {
                    alert('‚úÖ Successfully Published!');
                    e.target.reset();
                    loadGallery();
                } else {
                    throw new Error(data.message || 'Upload failed');
                }
            } catch (err) {
                alert(`‚ùå Error: ${err.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });

        // Delete Logic
        async function deletePhoto(photoId) {
            if (!confirm('‚ö†Ô∏è Confirm Deletion: This action cannot be undone.')) {
                return;
            }
            
            try {
                const res = await fetch(`${CONFIG.API_BASE_URL}/api/photos/${photoId}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                
                if (data.success) {
                    loadGallery();
                } else {
                    alert('‚ùå Failed to delete record');
                }
            } catch (err) {
                console.error('Error deleting photo:', err);
                alert('‚ùå System Error');
            }
        }
    </script>
</body>
</html>
